<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>健肌尋食-教練會員註冊</title>
<link th:href="@{css/bootstrap.css}" rel='stylesheet' type='text/css' />
<link th:href="@{css/style.css}" rel='stylesheet' type='text/css' />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<script th:src="@{js/jquery.min.js}"></script>
    <style>
        .container1 {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .input-container {
            float: auto;
            margin: 0;
            padding: 20px;
        }

        .input-container input {
            border-radius: 30px;
        }

        #emailVerificationForm {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        button[type="button"] {
            width: 40%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 30px;
            margin: 10px;
            /* background-color: aqua; */
        }

        .button1 {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .button1 input {
            /* float: right; */
            margin-bottom: 50px;
            /* background-color: aqua; */
            background: #00BFF0;
			border: none;
			color: #FFF;
			padding: 10px 20px;
			cursor: pointer;
			font-family: 'Open Sans', sans-serif;
			outline: none;
			font-size: 1em;
			border-radius: 5px;
			transition: background 0.3s;
        }
        
        .input-error {
        	border: 2px solid red;
    	}
    	
    	.error {
        	color: red;
    	}
    	
    	.success {
        	color: green;
    	}
    	
    </style>
</head>

<body>
    <!-- start header_bottom -->
    <div class="header-bottom">
        <div class="container">
            <div class="header-bottom_left">
                <i class="phone"> </i><span>1-200-346-2986</span>
            </div>
            <div class="social">
                <ul>
                    <li class="facebook"><a href="#"><span> </span></a></li>
                    <li class="google"><a href="#"><span> </span></a></li>
                </ul>
            </div>
            <div class="clear"></div>
        </div>
    </div>
    <!-- start menu -->
    <div class="menu">
        <div class="container">
            <div class="logo">
                <a href="index.html"><img src="images/logo.png" alt="" /></a>
            </div>
            <div class="h_menu4"><!-- start h_menu4 -->
                <a class="toggleMenu" href="#">Menu</a>
                <ul class="nav">
                    <li><a href="@{index}">主頁</a></li>
                    <li class="active"><a href="@{login}">會員專區</a></li>
                    <li><a href="trainers.html">課程</a></li>
                    <li><a href="classes.html">教室</a></li>
                    <li><a href="blog.html">健康飲食</a></li>
                    <li><a href="pricing.html">線上商城</a></li>
                    <li><a href="contact.html">健康地圖</a></li>
                </ul>
                <script type="text/javascript" src="js/nav.js"></script>
            </div><!-- end h_menu4 -->
            <div class="clear"></div>
        </div>
    </div>
    <div class="container1">
        <h2>電子郵件驗證</h2>
        <form id="emailVerificationForm" method="post" action="/saveEmail">
            <div class="input-container">
                <label for="email">請輸入電子郵件</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="input-container">
                <label for="code">請輸入驗證碼</label>
                <input type="text" id="code" name="code" required>
            </div>
            <button type="button" onclick="sendVerificationCode()">發送驗證碼</button>
            <button type="button" onclick="verifyCode()">送出</button>
            <div id="message"></div>
            <div class="clear"> </div>
            <a id="completePageLink" th:href="@{/coach_skill}" style="display:none;"></a>
        </form>
    </div>
    <!-- end menu -->
    <div class="main">
        <div class="footer-bottom">
            <div class="container">
                <div class="row section group">
                    <div class="col-md-4">
                        <h4 class="m_7">訂閱電子報</h4>
                        <!-- 簡短描述新聞訂閱 -->
                        <p class="m_8">關於我們有關的飲食通知</p>
                        <!-- 訂閱表單 -->
                        <form class="subscribe">
                            <!-- 電子郵件輸入框 -->
                            <input type="text" value="輸入電子郵件" onfocus="this.value = '';"
                                onblur="if (this.value == '') {this.value = '輸入電子郵件';}">
                        </form>
                        <!-- 提交按鈕 -->
                        <div class="subscribe1">
                            <a href="#">送出電子郵件<i class="but_arrow"> </i></a>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="f-logo">
                            <img src="images/logo.png" alt="" />
                        </div>
                        <p class="m_9">關於現代人對於健康越來越有意識，但時常沒有正確的觀念來執行，導致會讓人無法繼續維持下去。
                            <br>
                            於是乎我們就想要建立一個可以幫助大家 & 功能方便網站，可以透過此網站來學習正確的觀念，並且記錄自己的生活是否有達到健康的水準。
                        </p>
                        <p class="address">電話 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="m_10">(00) 222 666 444</span>
                        </p>
                        <p class="address">電子郵件 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
                                class="m_10">info[at]mycompany.com</span></p>
                    </div>
                    <div class="col-md-4">
                        <ul class="list">
                            <h4 class="m_7">Menu</h4>
                            <li><a href="#">會員</a></li>
                            <li><a href="#">Trainers</a></li>
                            <li><a href="#">Classes</a></li>
                            <li><a href="#">Pricing</a></li>
                            <li><a href="#">Privacy</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                        <ul class="list1">
                            <h4 class="m_7">Community</h4>
                            <li><a href="#">部落格</a></li>
                            <li><a href="#">Forum</a></li>
                            <li><a href="#">Support</a></li>
                            <li><a href="#">Newsletter</a></li>
                        </ul>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <div class="copy">
                    <p>© 2014 Template by <a href="http://w3layouts.com" target="_blank"> w3layouts</a></p>
                </div>
                <div class="social">
                    <ul>
                        <li class="facebook"><a href="#"><span> </span></a></li>
                        <li class="google"><a href="#"><span> </span></a></li>
                    </ul>
                </div>
                <div class="clear"></div>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <script>
    let verificationCode;

    function sendVerificationCode() {
        const emailInput = document.getElementById('email');
        const message = document.getElementById('message');
        message.textContent = '';
        message.classList.remove('error', 'success');
        emailInput.classList.remove('input-error');

        if (!validateEmail(emailInput.value)) {
            message.textContent = '請輸入有效的電子郵件地址';
            message.classList.add('error');
            emailInput.classList.add('input-error');
            return;
        }

        // 生成驗證碼
        verificationCode = Math.floor(100000 + Math.random() * 900000);
        console.log('發送的驗證碼是：' + verificationCode);  // 在真實應用中，你會通過電子郵件發送驗證碼

        // 使用AJAX發送POST請求到後端
        const emailTo = emailInput.value;
        const emailSubject = '您的驗證碼';
        const emailBody = `您的驗證碼是：${verificationCode}`;

        fetch('/course/sendEmail', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                emailTo: emailTo,
                emailSubject: emailSubject,
                emailBody: emailBody
            })
        })
        .then(response => response.text())
        .then(result => {
            message.textContent = result;
            message.classList.add(result.includes('成功') ? 'success' : 'error');
        })
        .catch(error => {
            console.error('錯誤:', error);
            message.textContent = '發送郵件時發生錯誤';
            message.classList.add('error');
        });
    }

    function verifyCode() {
        const codeInput = document.getElementById('code');
        const emailInput = document.getElementById('email');
        const message = document.getElementById('message');
        message.textContent = '';
        message.classList.remove('error', 'success');
        codeInput.classList.remove('input-error');

        if (!codeInput.value) {
            message.textContent = '請輸入驗證碼';
            message.classList.add('error');
            codeInput.classList.add('input-error');
            return;
        }

        if (codeInput.value == verificationCode) {
            message.textContent = '驗證成功';
            message.classList.add('success');
            
            // 提交表單資料到後端
            fetch('/saveEmail', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    email: emailInput.value
                })
            })
            .then(response => response.text())
            .then(result => {
                // 觸發隱藏的連結點擊以跳轉頁面
                document.getElementById('completePageLink').click();
            })
            .catch(error => {
                console.error('錯誤:', error);
                message.textContent = '保存電子郵件時發生錯誤';
                message.classList.add('error');
            });
        } else {
            message.textContent = '驗證碼錯誤';
            message.classList.add('error');
            codeInput.classList.add('input-error');
        }
    }

    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
</script>
</body>

</html>